<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TTSåŠŸèƒ½å¿«é€Ÿæµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        button {
            background: #007acc;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #005a9e;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        textarea {
            width: 100%;
            height: 100px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            resize: vertical;
        }
        select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin: 5px;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 5px;
            background: #f8f9fa;
            border-left: 4px solid #007acc;
        }
        .error {
            border-left-color: #dc3545;
            background: #f8d7da;
            color: #721c24;
        }
        .success {
            border-left-color: #28a745;
            background: #d4edda;
            color: #155724;
        }
        audio {
            width: 100%;
            margin-top: 10px;
        }
        .mode-indicator {
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            margin-bottom: 20px;
            font-weight: bold;
        }
        .mock-mode {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¤ TTSè¯­éŸ³åˆæˆåŠŸèƒ½æµ‹è¯•</h1>
        <p>è¿™ä¸ªé¡µé¢å¯ä»¥æµ‹è¯•å‰ç«¯TTSæ¨¡å—æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Œæ”¯æŒMockæ¨¡å¼ã€‚</p>

        <div class="mode-indicator mock-mode" id="modeIndicator">
            å½“å‰æ¨¡å¼: Mockæ¨¡å¼ (æ— éœ€åç«¯æœåŠ¡)
        </div>

        <div class="test-section">
            <h3>ğŸ“ æ–‡æœ¬è¾“å…¥</h3>
            <textarea id="textInput" placeholder="è¯·è¾“å…¥è¦è½¬æ¢ä¸ºè¯­éŸ³çš„æ–‡æœ¬...">
ä½ å¥½ï¼Œè¿™æ˜¯ä¸€ä¸ªTTSè¯­éŸ³åˆæˆæµ‹è¯•ã€‚Hello, this is a TTS speech synthesis test.
            </textarea>

            <h4>é€‰æ‹©å‚æ•°:</h4>
            <label>è¯­è¨€: </label>
            <select id="languageSelect">
                <option value="chinese">ä¸­æ–‡</option>
                <option value="english">è‹±æ–‡</option>
                <option value="japanese">æ—¥æ–‡</option>
                <option value="korean">éŸ©æ–‡</option>
                <option value="cantonese">ç²¤è¯­</option>
            </select>

            <label>éŸ³è‰²: </label>
            <select id="voiceSelect">
                <option value="longwan">é¾™å©‰</option>
                <option value="xiaoqing">æ™“æ™´</option>
                <option value="xiaomeng">æ™“æ¢¦</option>
                <option value="xiaoxue">æ™“é›ª</option>
                <option value="xiaoyun">æ™“äº‘</option>
            </select>

            <label>æ ¼å¼: </label>
            <select id="formatSelect">
                <option value="mp3">MP3</option>
                <option value="wav">WAV</option>
                <option value="ogg">OGG</option>
            </select>
        </div>

        <div class="test-section">
            <h3>ğŸµ è¯­éŸ³åˆæˆæµ‹è¯•</h3>
            <button id="testFileMode">ğŸ“ æµ‹è¯•æ–‡ä»¶æ¨¡å¼</button>
            <button id="testStreamMode">ğŸŒŠ æµ‹è¯•æµæ¨¡å¼</button>
            <button id="testGetVoices">ğŸ­ è·å–éŸ³è‰²åˆ—è¡¨</button>
            <button id="testServiceStatus">ğŸ” æ£€æŸ¥æœåŠ¡çŠ¶æ€</button>

            <div id="testResult"></div>

            <div id="audioContainer" style="display: none;">
                <h4>ğŸ”Š éŸ³é¢‘æ’­æ”¾å™¨</h4>
                <audio id="audioPlayer" controls></audio>
                <br>
                <button id="downloadAudio">ğŸ’¾ ä¸‹è½½éŸ³é¢‘</button>
            </div>
        </div>

        <div class="test-section">
            <h3>ğŸ“Š æµ‹è¯•è¯´æ˜</h3>
            <ul>
                <li><strong>æ–‡ä»¶æ¨¡å¼</strong>: ç”ŸæˆéŸ³é¢‘æ–‡ä»¶å¹¶è¿”å›ä¸‹è½½é“¾æ¥</li>
                <li><strong>æµæ¨¡å¼</strong>: ç›´æ¥è¿”å›éŸ³é¢‘æµæ•°æ®</li>
                <li><strong>è·å–éŸ³è‰²</strong>: è·å–æ”¯æŒçš„éŸ³è‰²åˆ—è¡¨</li>
                <li><strong>æœåŠ¡çŠ¶æ€</strong>: æ£€æŸ¥TTSæœåŠ¡è¿è¡ŒçŠ¶æ€</li>
            </ul>
            <p><em>æ³¨æ„ï¼šå½“å‰ä½¿ç”¨Mockæ¨¡å¼ï¼Œæ— éœ€çœŸå®çš„åç«¯æœåŠ¡å³å¯æµ‹è¯•æ‰€æœ‰åŠŸèƒ½ã€‚</em></p>
        </div>
    </div>

    <script>
        // æ¨¡æ‹ŸTTS API
        class MockTTSService {
            constructor() {
                this.mockMode = true;
                this.baseURL = '/api/tts';
            }

            async generateSpeechFile(text, voice, language, format) {
                // æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ
                await this.delay(1000);

                if (!text || text.trim().length === 0) {
                    throw new Error('æ–‡æœ¬å†…å®¹ä¸èƒ½ä¸ºç©º');
                }

                if (text.length > 5000) {
                    throw new Error('æ–‡æœ¬å†…å®¹è¿‡é•¿ï¼Œè¯·æ§åˆ¶åœ¨5000å­—ç¬¦ä»¥å†…');
                }

                const timestamp = Date.now();
                const filename = `tts_${voice}_${timestamp}.mp3`;
                const filePath = `/tmp/tts/${filename}`;

                return {
                    success: true,
                    filePath: filePath,
                    message: 'è¯­éŸ³ç”ŸæˆæˆåŠŸ (Mockæ¨¡å¼)'
                };
            }

            async generateSpeechStream(text, voice, language, format) {
                await this.delay(800);

                if (!text || text.trim().length === 0) {
                    throw new Error('æ–‡æœ¬å†…å®¹ä¸èƒ½ä¸ºç©º');
                }

                // è¿”å›æ¨¡æ‹Ÿçš„base64éŸ³é¢‘æ•°æ® (éå¸¸çŸ­çš„é™éŸ³MP3)
                const mockAudioBase64 = 'SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4Ljc2LjEwMAAAAAAAAAAAAAAA//tQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAAEaAAzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMz//////////////////////////////////////////////////////////////////8AAAAATGF2YzU4LjEzAAAAAAAAAAAAAAAAJAQKAAAAAAAADrABXFU3AAAAAAgAA0AAAAgAA0AAAAgAA0AAAAgAA0AAAQAAAAgAA0AAAAgAA0AAAAgAA0AAAQAA';

                const audioBytes = Uint8Array.from(atob(mockAudioBase64), c => c.charCodeAt(0));
                const blob = new Blob([audioBytes], { type: 'audio/mpeg' });
                return URL.createObjectURL(blob);
            }

            async getVoices() {
                await this.delay(300);

                return {
                    success: true,
                    data: {
                        chinese: ['longwan', 'xiaoqing', 'xiaomeng', 'xiaoxue', 'xiaoyun'],
                        english: ['anna', 'brian', 'cathy', 'david', 'emily'],
                        japanese: ['haruka', 'hikari', 'kaori', 'mai', 'nana'],
                        korean: ['jihoon', 'sujin', 'yuna', 'minjun', 'hyejin'],
                        cantonese: ['xiaomin', 'xiaofen', 'xiaoya', 'xiaoying', 'xiaomei']
                    },
                    message: 'è·å–éŸ³è‰²æˆåŠŸ (Mockæ¨¡å¼)'
                };
            }

            async checkStatus() {
                await this.delay(200);

                return {
                    success: true,
                    data: {
                        status: 'running',
                        version: '1.0.0',
                        supportedFormats: ['mp3', 'wav', 'ogg'],
                        maxTextLength: 5000
                    },
                    message: 'TTSæœåŠ¡è¿è¡Œæ­£å¸¸ (Mockæ¨¡å¼)'
                };
            }

            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        // åˆå§‹åŒ–
        const ttsService = new MockTTSService();
        let currentAudioUrl = null;

        // DOMå…ƒç´ 
        const textInput = document.getElementById('textInput');
        const languageSelect = document.getElementById('languageSelect');
        const voiceSelect = document.getElementById('voiceSelect');
        const formatSelect = document.getElementById('formatSelect');
        const testResult = document.getElementById('testResult');
        const audioContainer = document.getElementById('audioContainer');
        const audioPlayer = document.getElementById('audioPlayer');

        // æ˜¾ç¤ºç»“æœ
        function showResult(message, isSuccess = true) {
            testResult.innerHTML = `
                <div class="result ${isSuccess ? 'success' : 'error'}">
                    <strong>${isSuccess ? 'âœ… æˆåŠŸ' : 'âŒ é”™è¯¯'}:</strong> ${message}
                </div>
            `;
        }

        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoading(button) {
            const originalText = button.textContent;
            button.textContent = 'â³ å¤„ç†ä¸­...';
            button.disabled = true;

            return () => {
                button.textContent = originalText;
                button.disabled = false;
            };
        }

        // æ›´æ–°éŸ³è‰²é€‰é¡¹
        function updateVoiceOptions() {
            const language = languageSelect.value;
            const voices = {
                chinese: ['longwan', 'xiaoqing', 'xiaomeng', 'xiaoxue', 'xiaoyun'],
                english: ['anna', 'brian', 'cathy', 'david', 'emily'],
                japanese: ['haruka', 'hikari', 'kaori', 'mai', 'nana'],
                korean: ['jihoon', 'sujin', 'yuna', 'minjun', 'hyejin'],
                cantonese: ['xiaomin', 'xiaofen', 'xiaoya', 'xiaoying', 'xiaomei']
            };

            const labels = {
                chinese: ['é¾™å©‰', 'æ™“æ™´', 'æ™“æ¢¦', 'æ™“é›ª', 'æ™“äº‘'],
                english: ['Anna', 'Brian', 'Cathy', 'David', 'Emily'],
                japanese: ['æ˜¥é¦™', 'å…‰', 'é¦™ç»‡', 'èˆ', 'å¥ˆå¥ˆ'],
                korean: ['æ™ºå‹‹', 'ç§€ç', 'å…å¨œ', 'æ°‘ä¿Š', 'æƒ ç'],
                cantonese: ['å°æ•', 'å°èŠ¬', 'å°é›…', 'å°è¹', 'å°ç¾']
            };

            voiceSelect.innerHTML = '';
            const voiceList = voices[language] || [];
            const labelList = labels[language] || [];

            voiceList.forEach((voice, index) => {
                const option = document.createElement('option');
                option.value = voice;
                option.textContent = labelList[index] || voice;
                voiceSelect.appendChild(option);
            });
        }

        // æµ‹è¯•æ–‡ä»¶æ¨¡å¼
        document.getElementById('testFileMode').addEventListener('click', async function() {
            const restoreButton = showLoading(this);

            try {
                const result = await ttsService.generateSpeechFile(
                    textInput.value,
                    voiceSelect.value,
                    languageSelect.value,
                    formatSelect.value
                );

                if (result.success) {
                    // æ¨¡æ‹ŸéŸ³é¢‘URL
                    currentAudioUrl = await ttsService.generateSpeechStream(
                        textInput.value,
                        voiceSelect.value,
                        languageSelect.value,
                        formatSelect.value
                    );

                    audioPlayer.src = currentAudioUrl;
                    audioContainer.style.display = 'block';

                    showResult(`æ–‡ä»¶ç”ŸæˆæˆåŠŸï¼æ–‡ä»¶è·¯å¾„: ${result.filePath}`);
                }
            } catch (error) {
                showResult(error.message, false);
            } finally {
                restoreButton();
            }
        });

        // æµ‹è¯•æµæ¨¡å¼
        document.getElementById('testStreamMode').addEventListener('click', async function() {
            const restoreButton = showLoading(this);

            try {
                currentAudioUrl = await ttsService.generateSpeechStream(
                    textInput.value,
                    voiceSelect.value,
                    languageSelect.value,
                    formatSelect.value
                );

                audioPlayer.src = currentAudioUrl;
                audioContainer.style.display = 'block';

                showResult('æµæ¨¡å¼ç”ŸæˆæˆåŠŸï¼éŸ³é¢‘å·²åŠ è½½åˆ°æ’­æ”¾å™¨ã€‚');
            } catch (error) {
                showResult(error.message, false);
            } finally {
                restoreButton();
            }
        });

        // æµ‹è¯•è·å–éŸ³è‰²
        document.getElementById('testGetVoices').addEventListener('click', async function() {
            const restoreButton = showLoading(this);

            try {
                const result = await ttsService.getVoices();

                if (result.success) {
                    const voicesInfo = Object.entries(result.data)
                        .map(([lang, voices]) => `${lang}: ${voices.join(', ')}`)
                        .join('\n');

                    showResult(`éŸ³è‰²åˆ—è¡¨è·å–æˆåŠŸï¼\n\n${voicesInfo}`);
                }
            } catch (error) {
                showResult(error.message, false);
            } finally {
                restoreButton();
            }
        });

        // æµ‹è¯•æœåŠ¡çŠ¶æ€
        document.getElementById('testServiceStatus').addEventListener('click', async function() {
            const restoreButton = showLoading(this);

            try {
                const result = await ttsService.checkStatus();

                if (result.success) {
                    const statusInfo = `
                        çŠ¶æ€: ${result.data.status}
                        ç‰ˆæœ¬: ${result.data.version}
                        æ”¯æŒæ ¼å¼: ${result.data.supportedFormats.join(', ')}
                        æœ€å¤§æ–‡æœ¬é•¿åº¦: ${result.data.maxTextLength}å­—ç¬¦
                    `;

                    showResult(`æœåŠ¡çŠ¶æ€æ£€æŸ¥æˆåŠŸï¼\n\n${statusInfo}`);
                }
            } catch (error) {
                showResult(error.message, false);
            } finally {
                restoreButton();
            }
        });

        // ä¸‹è½½éŸ³é¢‘
        document.getElementById('downloadAudio').addEventListener('click', function() {
            if (currentAudioUrl) {
                const link = document.createElement('a');
                link.href = currentAudioUrl;
                link.download = `tts-audio-${Date.now()}.mp3`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

                showResult('éŸ³é¢‘ä¸‹è½½å·²å¼€å§‹ï¼');
            }
        });

        // ç›‘å¬è¯­è¨€å˜åŒ–
        languageSelect.addEventListener('change', updateVoiceOptions);

        // åˆå§‹åŒ–
        updateVoiceOptions();
    </script>
</body>
</html>