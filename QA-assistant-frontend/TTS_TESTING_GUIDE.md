# TTS模块前端测试指南

## 🎯 概述

本项目已配置完整的TTS（文本转语音）模块前端测试环境，支持Mock模式和真实API模式，无需后端服务即可测试所有TTS功能。

## 🚀 快速开始

### 1. 启动开发服务器

```bash
cd /Users/skysummer/Documents/project/QA-assistant-backend/QA-assistant-frontend
pnpm dev
```

服务器将在 `http://localhost:8001/` 启动

### 2. 访问测试页面

#### 方法1: Vue应用内测试页面
- 访问: `http://localhost:8001/tts-test`
- 完整的Vue组件测试界面
- 支持Mock/真实API模式切换

#### 方法2: 独立HTML测试页面
- 访问: `http://localhost:8001/test-tts.html`
- 纯HTML/JS实现，无依赖
- 内置完整Mock服务

## 🔧 功能特性

### Mock模式特点
- ✅ **完全离线** - 无需任何后端服务
- ⏱️ **模拟延迟** - 真实模拟网络请求时间（1秒、0.8秒等）
- 🎵 **静音音频** - 生成有效的MP3格式音频数据
- 📊 **完整数据** - 返回真实格式的API响应
- 🎭 **多语言支持** - 中文、英文、日文、韩文、粤语
- 🔊 **多音色支持** - 每种语言5种不同音色

### 支持的功能
1. **语音生成**
   - 📁 文件模式: 生成音频文件URL
   - 🌊 流模式: 直接返回音频流数据

2. **配置选项**
   - 🌍 语言选择 (5种语言)
   - 🎭 音色选择 (25种音色)
   - 📋 音频格式 (MP3, WAV, OGG)

3. **辅助功能**
   - 🔍 服务状态检查
   - 📊 音色列表获取
   - 💾 音频文件下载
   - ⚙️ 配置持久化存储

## 📱 使用界面

### Vue测试页面 (`/tts-test`)

#### 基础配置区域
- 文本输入框（支持中英文，最多5000字符）
- 语言下拉选择
- 音色下拉选择（根据语言动态更新）
- 音频格式选择

#### 功能测试区域
- **测试语音生成（文件模式）** - 模拟文件生成流程
- **测试语音生成（流模式）** - 直接生成音频流
- **测试获取音色** - 获取支持的音色列表
- **测试服务状态** - 检查TTS服务状态

#### 模式切换
- **Mock模式** 🟡 - 无需后端，使用模拟数据
- **API模式** 🟢 - 连接真实后端服务

#### 结果显示
- 实时状态显示（就绪/生成中）
- 音频URL显示
- 错误信息提示
- 内置音频播放器
- 音频下载功能

### 独立HTML测试页面 (`/test-tts.html`)

完全独立的测试环境，包含：
- 完整的UI界面
- 内置Mock TTS服务
- 音频播放和下载
- 实时状态反馈

## 🛠️ 技术实现

### 核心文件结构
```
src/
├── hooks/
│   └── useTTS.ts              # TTS功能核心Hook (内置Mock模式)
├── components/
│   ├── TTSSettings/           # TTS设置组件
│   └── AudioPlayer/           # 音频播放器组件
├── views/
│   ├── tts-test/              # Vue测试页面
│   └── assistant/
│       └── components/
│           └── ChatWindow.vue # 聊天窗口(已修复API调用)
└── router/modules/
    └── tts-test.ts            # 测试页面路由
```

### Mock模式实现

在 `src/hooks/useTTS.ts` 中：

```typescript
// Mock模式开关
const mockMode = ref(true) // 默认启用Mock模式

// 在每个API函数中检查Mock模式
if (mockMode.value) {
  // 模拟网络延迟
  await new Promise(resolve => setTimeout(resolve, 1000))

  // 返回模拟数据
  return {
    success: true,
    filePath: `/tmp/tts/tts_${voice}_${timestamp}.mp3`,
    message: '语音生成成功 (Mock模式)'
  }
}
```

## 🔍 测试步骤

### 基础功能测试

1. **访问测试页面**
   ```
   http://localhost:8001/tts-test
   ```

2. **测试文本输入**
   - 输入中英文混合文本
   - 验证字符限制（最多5000字符）

3. **测试语言和音色**
   - 切换不同语言，验证音色选项更新
   - 测试所有25种音色组合

4. **测试语音生成**
   - 点击"测试语音生成（文件模式）"
   - 验证1秒后生成成功提示
   - 检查音频播放器是否出现并可播放

5. **测试流模式**
   - 点击"测试语音生成（流模式）"
   - 验证0.8秒后生成成功
   - 确认音频可以直接播放

6. **测试其他功能**
   - 获取音色列表（0.3秒延迟）
   - 检查服务状态（0.2秒延迟）
   - 下载音频文件

### 模式切换测试

1. **切换到API模式**
   - 关闭Mock模式开关
   - 尝试语音生成（预期会显示API错误，因为没有后端）

2. **切换回Mock模式**
   - 重新启用Mock模式
   - 验证功能恢复正常

### 集成测试

在AI助手页面测试：
1. 访问 `http://localhost:8001/`
2. 启用TTS设置（右上角设置按钮）
3. 发送消息，验证TTS功能正常工作
4. 检查是否有404错误（已修复）

## 📋 测试清单

- [ ] 文本输入和验证
- [ ] 语言切换功能
- [ ] 音色动态更新
- [ ] 文件模式语音生成
- [ ] 流模式语音生成
- [ ] 音频播放功能
- [ ] 音频下载功能
- [ ] 服务状态检查
- [ ] 音色列表获取
- [ ] Mock/ API模式切换
- [ ] 配置持久化存储
- [ ] 错误处理和提示
- [ ] AI助手集成测试

## 🚨 注意事项

1. **Mock音频数据**: 生成的是静音MP3，这是正常的模拟行为
2. **网络延迟**: Mock模式下会模拟真实网络延迟（0.2-1秒）
3. **浏览器兼容**: 现代浏览器均支持音频播放功能
4. **文件下载**: 生成的音频文件可以通过浏览器下载
5. **配置存储**: TTS配置会自动保存到localStorage

## 🎉 完成

现在你可以在没有后端服务的情况下完整测试前端TTS模块的所有功能！

如需连接真实后端，只需在代码中设置 `mockMode.value = false` 即可切换到API模式。